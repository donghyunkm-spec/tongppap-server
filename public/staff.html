<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통빵 통합관리 시스템</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="loginOverlay" class="modal-overlay" style="display:flex;">
        <div class="modal-box">
            <h2 style="text-align:center; color:#2e7d32;">🔐 통빵 관리자 로그인</h2>
            <p style="text-align:center; font-size:12px; color:#666; margin-bottom:20px;">
                사장님께 부여받은 ID/PW를 입력하세요.
            </p>
            <div class="modal-field">
                <input type="text" id="loginId" placeholder="아이디" onkeypress="if(event.key==='Enter') document.getElementById('loginPw').focus()">
            </div>
            <div class="modal-field">
                <input type="password" id="loginPw" placeholder="비밀번호" onkeypress="if(event.key==='Enter') doLogin()">
            </div>
            <div id="loginError" style="color:red; font-size:12px; text-align:center; margin-bottom:10px; display:none;"></div>
            <button class="btn" onclick="doLogin()">로그인</button>
        </div>
    </div>

    <div class="container" id="mainContent" style="display:none;">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 id="pageTitle"><i class="fas fa-utensils"></i> 통빵 관리시스템</h1>
                <div style="text-align:right;">
                    <div id="userInfo" style="font-size:14px; color:white; font-weight:bold; margin-bottom:5px;"></div>
                    <button onclick="doLogout()" style="font-size:11px; padding:5px 10px; border-radius:15px; border:none; background:rgba(255,255,255,0.3); color:white; cursor:pointer;">로그아웃</button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('schedule')">🕒 근무/직원관리</button>
            <button class="tab manager-only" onclick="switchTab('accounting')">💰 매입/매출</button>
            <button class="tab admin-only" onclick="switchTab('analysis')">📊 손익분석</button>
        </div>

        <div id="schedule-content" class="tab-content active">
            <div id="staff-view-only" style="display:none;">
                <div class="status-container">
                    <h3>👋 나의 근무 일정</h3>
                    <div id="myScheduleList" class="list-group"></div>
                    
                    <div style="margin-top:30px; border-top:2px solid #eee; padding-top:20px;">
                        <h3>⏰ 오늘 출퇴근 기록</h3>
                        <div id="todayClockStatus" style="background:#f8f9fa; padding:15px; border-radius:8px; margin:10px 0;">
                            <div style="font-size:13px; color:#666;">출근: <span id="clockInTime">-</span></div>
                            <div style="font-size:13px; color:#666;">퇴근: <span id="clockOutTime">-</span></div>
                        </div>
                        <button onclick="clockIn()" class="btn" style="background:#28a745; margin-bottom:10px;">출근하기</button>
                        <button onclick="clockOut()" class="btn" style="background:#dc3545;">퇴근하기</button>
                    </div>
                </div>
            </div>

            <div id="manager-schedule-view" style="display:none;">
                <div class="accounting-card" style="padding:10px; margin-bottom:15px;">
                    <div class="tabs" id="schedule-subtabs" style="grid-template-columns: repeat(4, 1fr); margin-bottom:0;">
                        <button class="tab active" onclick="switchSubTab('daily')">일별</button>
                        <button class="tab" onclick="switchSubTab('weekly')">주간</button>
                        <button class="tab" onclick="switchSubTab('monthly')">월별</button>
                        <button class="tab admin-only" onclick="switchSubTab('staff-manage')">👥 직원관리</button>
                    </div>
                </div>

                <div id="daily-schedule-view" class="status-container">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <button onclick="moveCalendar(-1)" class="number-btn">&lt;</button>
                        <h2 id="calendarTitle" style="margin:0;">2024년 12월</h2>
                        <button onclick="moveCalendar(1)" class="number-btn">&gt;</button>
                    </div>
                    <div id="calendarArea"></div>
                </div>

                <div id="weekly-schedule-view" class="status-container" style="display:none;">
                    <h3>📅 주간 근무 현황</h3>
                    <div id="weeklyCalendarArea">
                        <p style="text-align:center; color:#999; padding:40px;">주간 뷰 구현 예정입니다.</p>
                    </div>
                </div>

                <div id="monthly-schedule-view" class="status-container" style="display:none;">
                    <h3>📅 월간 근무 현황</h3>
                    <div id="monthlyCalendarArea">
                        <p style="text-align:center; color:#999; padding:40px;">월간 뷰 구현 예정입니다.</p>
                    </div>
                </div>
            </div>
            
            <div id="admin-staff-manage" style="display:none;" class="status-container">
                <h3>👥 직원/알바 관리</h3>
                <div style="background:#fff3cd; padding:10px; border-radius:5px; margin-bottom:15px; font-size:13px;">
                    💡 직원을 등록하면 자동으로 ID/PW가 생성됩니다. 생성된 정보는 직원에게 전달하세요.
                </div>
                
                <div style="margin-bottom: 30px; background:#e8f5e9; padding:15px; border-radius:8px;">
                    <h3>📝 일괄 등록 (빠른 등록)</h3>
                    <div style="background:white; padding:10px; border-radius:5px; margin:10px 0; font-size:12px;">
                        <strong>💡 입력 예시:</strong> 홍길동, 월화수, 18:00~23:00<br>
                        <span style="color:#666;">* 한 줄에 한 명씩 입력 (이름, 근무요일, 근무시간) - 시급제 알바로 등록됩니다</span>
                    </div>
                    <textarea id="bulkText" placeholder="홍길동, 월화수, 18:00~23:00&#10;김영희, 목금토, 17:00~22:00" 
                            style="width:100%; height:100px; padding:10px; border:1px solid #ddd; border-radius:5px; font-size:14px;"></textarea>
                    <button class="btn" onclick="processBulkText()" style="width:100%; margin-top:10px; background:#2e7d32;">
                        ✨ 한 번에 등록하기
                    </button>
                </div>

                <hr style="margin:20px 0; border:none; border-top:2px solid #eee;">

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0;">📋 등록된 직원/알바 목록</h3>
                    <button onclick="openAddStaffModal()" class="btn" style="background:#1976d2; padding:8px 15px; font-size:13px;">
                        ➕ 직접 추가
                    </button>
                </div>
                <div id="staffListArea"></div>
            </div>
        </div>

        <div id="accounting-content" class="tab-content">
            <div class="accounting-card" style="padding:10px; margin-bottom:15px;">
                <div class="tabs" style="grid-template-columns: repeat(5, 1fr); margin-bottom:0;">
                    <button class="tab active" onclick="switchAccSubTab('daily-input')">일일입력</button>
                    <button class="tab" onclick="switchAccSubTab('history')">입력내역</button>
                    <button class="tab admin-only" onclick="switchAccSubTab('prediction')">예상순익</button>
                    <button class="tab admin-only" onclick="switchAccSubTab('dashboard')">월간분석</button>
                    <button class="tab admin-only" onclick="switchAccSubTab('fixed-cost')">고정비</button>
                </div>
            </div>

            <div id="daily-input" class="acc-sub-content active">
                <div class="status-container">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                        <div style="display:flex; gap:10px; align-items:center;">
                            <button onclick="changeDailyDate(-1)" class="number-btn">&lt;</button>
                            <input type="date" id="accDate" onchange="loadDailyData()" style="padding:10px; font-size:16px; border:2px solid #2e7d32; border-radius:5px;">
                            <button onclick="changeDailyDate(1)" class="number-btn">&gt;</button>
                            <button onclick="goToToday()" style="background:white; border:1px solid #2e7d32; color:#2e7d32; padding:8px 15px; border-radius:5px; cursor:pointer; font-size:13px;">📅 오늘</button>
                        </div>
                        <button onclick="saveDailyData()" class="pulse-btn" style="background:#2e7d32; color:white; border:none; padding:10px 20px; border-radius:5px; font-weight:bold;">💾 일일 저장</button>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                        <div class="input-box">
                            <h4 style="margin-top:0;">🏪 1루 매출</h4>
                            <div class="input-grid">
                                <div><span class="category-label">💳 카드</span><input type="number" id="base1_card" class="money-input" placeholder="0"></div>
                                <div><span class="category-label">💵 현금</span><input type="number" id="base1_cash" class="money-input" placeholder="0"></div>
                                <div><span class="category-label">🚚 배달</span><input type="number" id="base1_delivery" class="money-input" placeholder="0"></div>
                            </div>
                        </div>
                        
                        <div class="input-box">
                            <h4 style="margin-top:0;">🏪 3루 매출</h4>
                            <div class="input-grid">
                                <div><span class="category-label">💳 카드</span><input type="number" id="base3_card" class="money-input" placeholder="0"></div>
                                <div><span class="category-label">💵 현금</span><input type="number" id="base3_cash" class="money-input" placeholder="0"></div>
                                <div><span class="category-label">🚚 배달</span><input type="number" id="base3_delivery" class="money-input" placeholder="0"></div>
                            </div>
                        </div>
                    </div>

                    <div class="input-box">
                        <h4 style="margin-top:0;">💸 일일 지출</h4>
                        <div class="input-grid">
                            <div><span class="category-label">📦 고센유통</span><input type="number" id="gosen" class="money-input" placeholder="0"></div>
                            <div><span class="category-label">📦 한강유통</span><input type="number" id="hangang" class="money-input" placeholder="0"></div>
                            <div><span class="category-label">📦 기타잡비</span><input type="number" id="etc_cost" class="money-input" placeholder="0"></div>
                        </div>
                    </div>

                    <div class="input-box">
                        <h4 style="margin-top:0;">📝 특이사항</h4>
                        <textarea id="remarks" placeholder="특이사항을 입력하세요..." style="width:100%; height:80px; padding:10px; border:1px solid #ddd; border-radius:5px; font-size:14px;"></textarea>
                    </div>
                </div>
            </div>

            <div id="history" class="acc-sub-content">
                <div class="status-container">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <button onclick="changeHistoryMonth(-1)" class="number-btn">&lt;</button>
                        <h3 style="margin:0;" id="historyMonthDisplay">2024년 12월</h3>
                        <button onclick="changeHistoryMonth(1)" class="number-btn">&gt;</button>
                        <button onclick="goToCurrentMonth()" style="background:white; border:1px solid #2e7d32; color:#2e7d32; padding:8px 15px; border-radius:5px; cursor:pointer; font-size:13px;">📅 이번 달</button>
                    </div>
                    <div id="historyList"></div>
                </div>
            </div>

            <div id="prediction" class="acc-sub-content">
                <div class="status-container">
                    <h3>📊 예상 순익 분석 (<span id="predMonthDisplay"></span>)</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <button onclick="changePredMonth(-1)" class="number-btn">&lt;</button>
                        <button onclick="changePredMonth(1)" class="number-btn">&gt;</button>
                        <button onclick="goToPredCurrentMonth()" style="background:white; border:1px solid #2e7d32; color:#2e7d32; padding:8px 15px; border-radius:5px; cursor:pointer; font-size:13px;">📅 이번 달</button>
                    </div>
                    <div style="text-align:center; margin:20px 0;">
                        <select id="predStoreSelect" onchange="renderPrediction()" style="padding:10px; font-size:16px; border:2px solid #2e7d32; border-radius:5px;">
                            <option value="grand">통합 분석</option>
                            <option value="base1">1루만 보기</option>
                            <option value="base3">3루만 보기</option>
                        </select>
                    </div>
                    <div id="predictionResult"></div>
                </div>
            </div>

            <div id="dashboard" class="acc-sub-content">
                <div class="status-container">
                    <h3>📈 월간 분석 (<span id="dashMonthDisplay"></span>)</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <button onclick="changeDashMonth(-1)" class="number-btn">&lt;</button>
                        <button onclick="changeDashMonth(1)" class="number-btn">&gt;</button>
                        <button onclick="goToDashCurrentMonth()" style="background:white; border:1px solid #2e7d32; color:#2e7d32; padding:8px 15px; border-radius:5px; cursor:pointer; font-size:13px;">📅 이번 달</button>
                    </div>
                    <div style="text-align:center; margin:20px 0;">
                        <select id="dashStoreSelect" onchange="renderDashboard()" style="padding:10px; font-size:16px; border:2px solid #2e7d32; border-radius:5px;">
                            <option value="grand">통합 분석</option>
                            <option value="base1">1루만 보기</option>
                            <option value="base3">3루만 보기</option>
                        </select>
                    </div>
                    <div id="dashboardResult"></div>
                </div>
            </div>

            <div id="fixed-cost" class="acc-sub-content">
                <div class="status-container">
                    <h3>🏗️ 월 고정비 설정 (<span id="fixMonthDisplay"></span>)</h3>
                    <p style="font-size:12px; color:#666; margin-bottom:15px;">
                        * 수수료(30%)와 배달타자 수수료(4.95%)는 분석 시 매출에 따라 <strong>자동 계산</strong>되므로 입력하지 않습니다.
                    </p>
                    
                    <div class="tabs" style="grid-template-columns: 1fr 1fr; margin-bottom:15px;">
                        <button class="tab active" onclick="showFixTab('base1', this)">1루 고정비</button>
                        <button class="tab" onclick="showFixTab('base3', this)">3루 고정비</button>
                    </div>

                    <div id="fixFormArea"></div>
                    <button onclick="saveFixedCost()" style="width:100%; margin-top:15px; background:#d32f2f; color:white; padding:12px; border:none; font-weight:bold; border-radius:5px;">💾 월 고정비 저장</button>
                </div>
            </div>
        </div>

        <div id="analysis-content" class="tab-content">
            <div class="status-container">
                <div style="text-align:center; margin-bottom:20px;">
                    <input type="month" id="anMonth" onchange="loadAnalysis()" style="font-size:18px; padding:10px; border:2px solid #2e7d32; border-radius:5px;">
                </div>
                
                <div class="tabs" style="grid-template-columns: 1fr 1fr 1fr;">
                    <button class="tab" onclick="renderAnalysis('base1', this)">1루 분석</button>
                    <button class="tab" onclick="renderAnalysis('base3', this)">3루 분석</button>
                    <button class="tab active" onclick="renderAnalysis('grand', this)" style="background:#e8f5e9; color:#2e7d32; font-weight:bold;">통합 분석</button>
                </div>

                <div id="analysisResult" class="accounting-card">
                    <p style="text-align:center; color:#999; padding:20px;">조회할 월을 선택하세요.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 시급 설정 모달 -->
    <div id="editWageModal" class="modal-overlay">
        <div class="modal-box">
            <h3>💰 시급 설정</h3>
            <input type="hidden" id="editUserId">
            <div class="modal-field">
                <label>직원명</label>
                <input type="text" id="editUserName" disabled style="background:#eee;">
            </div>
            <div class="modal-field">
                <label>시급 (원)</label>
                <input type="number" id="editWage" placeholder="예: 10000">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="saveWage()">저장</button>
                <button class="btn" onclick="closeEditWageModal()" style="background:#666;">취소</button>
            </div>
        </div>
    </div>

    <!-- 직원 추가/수정 모달 -->
    <div id="staffModal" class="modal-overlay">
        <div class="modal-box" style="max-width:600px;">
            <h3 id="staffModalTitle">➕ 직원 추가</h3>
            <input type="hidden" id="editStaffId">
            
            <div class="modal-field">
                <label>이름 *</label>
                <input type="text" id="staffName" placeholder="홍길동">
            </div>
            
            <div class="modal-field">
                <label>직원 구분 *</label>
                <select id="staffType" onchange="toggleSalaryFields()">
                    <option value="hourly">알바 (시급제)</option>
                    <option value="monthly">직원 (월급제)</option>
                </select>
            </div>
            
            <div id="hourlyFields">
                <div class="modal-field">
                    <label>시급 (원)</label>
                    <input type="number" id="staffHourlyWage" placeholder="10000">
                </div>
            </div>
            
            <div id="monthlyFields" style="display:none;">
                <div class="modal-field">
                    <label>월급 (원)</label>
                    <input type="number" id="staffMonthlySalary" placeholder="2500000">
                </div>
            </div>
            
            <div class="modal-field">
                <label>근무 요일 선택</label>
                <div style="display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; margin-top:5px;">
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Mon" value="Mon" style="margin-right:3px;"> 월
                    </label>
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Tue" value="Tue" style="margin-right:3px;"> 화
                    </label>
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Wed" value="Wed" style="margin-right:3px;"> 수
                    </label>
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Thu" value="Thu" style="margin-right:3px;"> 목
                    </label>
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Fri" value="Fri" style="margin-right:3px;"> 금
                    </label>
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Sat" value="Sat" style="margin-right:3px;"> 토
                    </label>
                    <label style="display:flex; align-items:center; font-size:13px;">
                        <input type="checkbox" id="day_Sun" value="Sun" style="margin-right:3px;"> 일
                    </label>
                </div>
            </div>

            <div class="modal-field">
                <label>근무 시간</label>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input type="time" id="staffStartTime" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:5px;">
                    <span>~</span>
                    <input type="time" id="staffEndTime" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:5px;">
                </div>
            </div>
            
            <div class="modal-field">
                <label>입사일</label>
                <input type="date" id="staffStartDate">
            </div>
            
            <div class="modal-field">
                <label>퇴사일 (재직중이면 비워두세요)</label>
                <input type="date" id="staffEndDate">
            </div>
            
            <div class="modal-actions">
                <button class="btn" onclick="saveStaff()">💾 저장</button>
                <button class="btn" onclick="closeStaffModal()" style="background:#666;">취소</button>
            </div>
        </div>
    </div>

    <!-- 직원 등록 완료 모달 -->
    <div id="staffRegisterModal" class="modal-overlay">
        <div class="modal-box" style="max-width:600px;">
            <h3>✅ 직원 등록 완료!</h3>
            <p style="color:#666; font-size:13px; margin-bottom:20px;">
                아래 정보를 직원에게 전달하세요. (화면 캡처 또는 복사)
            </p>
            <div id="registeredStaffList" style="background:#f8f9fa; padding:15px; border-radius:5px; max-height:400px; overflow-y:auto;">
            </div>
            <div class="modal-actions" style="margin-top:20px;">
                <button class="btn" onclick="closeRegisterModal()" style="background:#2e7d32;">확인</button>
            </div>
        </div>
    </div>

    <!-- 근무 추가/수정 모달 -->
    <div id="scheduleModal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="scheduleModalTitle">➕ 근무/대타 추가</h3>
            <input type="hidden" id="scheduleEditId">
            <input type="hidden" id="scheduleUserId">
            
            <div class="modal-field">
                <label>직원 선택 *</label>
                <select id="scheduleStaffSelect" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;">
                    <option value="">선택하세요</option>
                </select>
            </div>
            
            <div class="modal-field">
                <label>날짜 *</label>
                <input type="date" id="scheduleDate">
            </div>
            
            <div class="modal-field">
                <label>시작 시간 *</label>
                <input type="time" id="scheduleStartTime">
            </div>
            
            <div class="modal-field">
                <label>종료 시간 *</label>
                <input type="time" id="scheduleEndTime">
            </div>
            
            <div class="modal-field">
                <label>타입</label>
                <select id="scheduleType" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;">
                    <option value="work">정규 근무</option>
                    <option value="substitute">대타</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button class="btn" onclick="saveSchedule()">💾 저장</button>
                <button class="btn" onclick="closeScheduleModal()" style="background:#666;">취소</button>
            </div>
        </div>
    </div>

    <script src="staff.js"></script>
</body>
</html>