<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>통빱 통합관리 시스템</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="loginOverlay" class="modal-overlay" style="display:flex;">
        <div class="modal-box">
            <h2 style="text-align:center; color:#2e7d32;">🔐 통빱 관리자 로그인</h2>
            <p style="text-align:center; font-size:12px; color:#666; margin-bottom:20px;">사장님께 부여받은 ID/PW를 입력하세요.</p>
            <div class="modal-field">
                <input type="text" id="loginId" placeholder="아이디" onkeypress="if(event.key==='Enter') document.getElementById('loginPw').focus()">
            </div>
            <div class="modal-field">
                <input type="password" id="loginPw" placeholder="비밀번호" onkeypress="if(event.key==='Enter') doLogin()">
            </div>
            <button class="btn" onclick="doLogin()">로그인</button>
        </div>
    </div>

    <div class="container" id="mainContent" style="display:none;">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 id="pageTitle"><i class="fas fa-rice-ball"></i> 통빱 관리시스템</h1>
                <div style="text-align:right;">
                    <div id="userInfo" style="font-size:14px; color:white; font-weight:bold; margin-bottom:5px;"></div>
                    <button onclick="doLogout()" style="font-size:11px; padding:5px 10px; border-radius:15px; border:none; background:rgba(255,255,255,0.3); color:white; cursor:pointer;">로그아웃</button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('schedule')">🕒 근무/직원관리</button>
            <button class="tab manager-only" onclick="switchTab('accounting')">💰 매입/매출</button>
            <button class="tab admin-only" onclick="switchTab('analysis')">📊 통합 손익분석</button>
        </div>

        <div id="schedule-content" class="tab-content active">
            <div id="staff-view-only" style="display:none;">
                <div class="status-container">
                    <h3>👋 나의 근무 일정</h3>
                    <div id="myScheduleList" class="list-group"></div>
                </div>
            </div>

            <div id="manager-schedule-view" style="display:none;">
                <div class="accounting-card" style="padding:10px; margin-bottom:15px;">
                    <div class="tabs" style="grid-template-columns: repeat(4, 1fr); margin-bottom:0;">
                        <button class="tab active" onclick="renderCalendar('daily')">일별</button>
                        <button class="tab" onclick="renderCalendar('weekly')">주간</button>
                        <button class="tab" onclick="renderCalendar('monthly')">월별</button>
                        <button class="tab admin-only" onclick="showStaffManage()">👥 직원관리</button>
                    </div>
                </div>

                <div class="status-container">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <button onclick="moveCalendar(-1)" class="number-btn"><</button>
                        <h2 id="calendarTitle" style="margin:0;">2024년 12월</h2>
                        <button onclick="moveCalendar(1)" class="number-btn">></button>
                    </div>
                    <div id="calendarArea">
                        </div>
                </div>
            </div>
            
            <div id="admin-staff-manage" style="display:none;" class="status-container">
                <h3>👥 직원/알바 관리 & 급여 예측</h3>
                <div style="background:#fff3cd; padding:10px; border-radius:5px; margin-bottom:15px; font-size:13px;">
                    💡 알바생 등록은 직원이 직접 하고, 사장님은 여기서 시급/월급 정보만 수정하세요.
                </div>
                <div id="staffListArea"></div>
            </div>
        </div>

        <div id="accounting-content" class="tab-content">
            <div class="status-container">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                    <input type="date" id="accDate" onchange="loadDailyData()" style="padding:10px; font-size:16px; border:2px solid #2e7d32; border-radius:5px;">
                    <button onclick="saveDailyData()" class="pulse-btn" style="background:#2e7d32; color:white; border:none; padding:10px 20px; border-radius:5px; font-weight:bold;">💾 일일 저장</button>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                    <div class="accounting-card" style="border-top:4px solid #1976D2;">
                        <h4 style="color:#1976D2; margin-bottom:10px;">⚾ 통빱 1루 매출</h4>
                        <div class="input-group-row"><span>💳 카드</span><input type="number" id="b1_card" class="money-input" placeholder="0"></div>
                        <div class="input-group-row"><span>💵 현금</span><input type="number" id="b1_cash" class="money-input" placeholder="0"></div>
                        <div class="input-group-row"><span>🛵 배달타자</span><input type="number" id="b1_deliv" class="money-input" placeholder="0"></div>
                    </div>
                    <div class="accounting-card" style="border-top:4px solid #E64A19;">
                        <h4 style="color:#E64A19; margin-bottom:10px;">⚾ 통빱 3루 매출</h4>
                        <div class="input-group-row"><span>💳 카드</span><input type="number" id="b3_card" class="money-input" placeholder="0"></div>
                        <div class="input-group-row"><span>💵 현금</span><input type="number" id="b3_cash" class="money-input" placeholder="0"></div>
                        <div class="input-group-row"><span>🛵 배달타자</span><input type="number" id="b3_deliv" class="money-input" placeholder="0"></div>
                    </div>
                </div>

                <div class="accounting-card" style="border-top:4px solid #FBC02D;">
                    <h4 style="color:#F57F17; margin-bottom:10px;">💸 공통 일일 지출 (매출 비율 자동 배분)</h4>
                    <div class="input-grid">
                        <div><span class="category-label">🚚 고센유통</span><input type="number" id="ex_gosen" class="money-input" placeholder="0"></div>
                        <div><span class="category-label">🥩 한강유통</span><input type="number" id="ex_hangang" class="money-input" placeholder="0"></div>
                        <div><span class="category-label">🎸 기타잡비</span><input type="number" id="ex_etc" class="money-input" placeholder="0"></div>
                    </div>
                    <div style="margin-top:10px;">
                        <span class="category-label">📝 특이사항</span>
                        <input type="text" id="ex_note" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;" placeholder="예: 단체 예약 취소 등">
                    </div>
                </div>
            </div>

            <div class="status-container admin-only" style="margin-top:20px; border:2px solid #d32f2f;">
                <h3 style="color:#d32f2f;">🏗️ 월 고정비 설정 (<span id="fixMonthDisplay"></span>)</h3>
                <p style="font-size:12px; color:#666;">* 수수료(30%)와 배달타자 수수료(4.95%)는 분석 시 매출에 따라 <strong>자동 계산</strong>되므로 입력하지 않습니다.</p>
                
                <div class="tabs" style="grid-template-columns: 1fr 1fr; margin-bottom:10px; margin-top:10px;">
                    <button class="tab active" onclick="showFixTab('base1', this)">1루 고정비</button>
                    <button class="tab" onclick="showFixTab('base3', this)">3루 고정비</button>
                </div>

                <div id="fixFormArea">
                    </div>
                <button onclick="saveFixedCost()" style="width:100%; margin-top:15px; background:#d32f2f; color:white; padding:12px; border:none; font-weight:bold; border-radius:5px;">월 고정비 저장</button>
            </div>
        </div>

        <div id="analysis-content" class="tab-content">
            <div class="status-container">
                <div style="text-align:center; margin-bottom:20px;">
                    <input type="month" id="anMonth" onchange="loadAnalysis()" style="font-size:18px; padding:5px;">
                </div>
                
                <div class="tabs" style="grid-template-columns: 1fr 1fr 1fr;">
                    <button class="tab active" onclick="renderAnalysis('base1', this)">1루 분석</button>
                    <button class="tab" onclick="renderAnalysis('base3', this)">3루 분석</button>
                    <button class="tab" onclick="renderAnalysis('grand', this)" style="background:#e8f5e9; color:#2e7d32; font-weight:bold;">통합 분석</button>
                </div>

                <div id="analysisResult" class="accounting-card">
                    <p style="text-align:center; color:#999; padding:20px;">조회할 월을 선택하세요.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="staff.js"></script>
</body>
</html>